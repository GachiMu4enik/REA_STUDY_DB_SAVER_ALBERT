# MySQL Database Setup and Triggers

## Описание
Этот репозиторий содержит скрипты для создания и наполнения базы данных, а также реализации триггеров для MySQL. В нем представлены следующие файлы:

- **db_create.sql** — Скрипт для создания структуры базы данных.
- **Data_insert.sql** — Скрипт для вставки тестовых данных в базу данных.
- **script_1.sql**, **script_2.sql**, **script_3.sql** — Примеры сложных и простых SQL запросов к базе данных.
- **trigger_1.sql**, **trigger_2.sql** — Триггеры для автоматических операций при изменении данных в таблицах.

## Требования
Для работы с базой данных вам понадобится:

- **MySQL Workbench** — инструмент для работы с MySQL.
- **MySQL Server** — сервер базы данных MySQL.

## Шаги по настройке

### 1. Установка MySQL Workbench и MySQL на вашем компьютере

#### Установка MySQL Workbench на macOS

1. Перейдите на сайт [MySQL Downloads](https://dev.mysql.com/downloads/installer/) и скачайте установочный файл **MySQL Workbench** для macOS.
2. Запустите установку и следуйте инструкциям на экране.

#### Установка MySQL Server

1. Для установки MySQL Server на macOS используйте Homebrew:
    ```bash
    brew install mysql
    ```
2. После установки MySQL, запустите сервер с помощью команды:
    ```bash
    brew services start mysql
    ```
3. Подключитесь к серверу:
    ```bash
    mysql -u root
    ```

### 2. Развертывание базы данных

1. Откройте **MySQL Workbench** и подключитесь к локальному серверу MySQL.
2. Вставьте в консоль MySQL скрипт **db_create.sql**, чтобы создать базу данных и все необходимые таблицы. Для этого:
    - Вставьте код из `db_create.sql` в окно MySQL Workbench.
    - Нажмите **Execute** (или **Ctrl+Enter**), чтобы выполнить скрипт.

### 3. Наполнение базы данных тестовыми данными

1. Откройте скрипт **Data_insert.sql** в MySQL Workbench.
2. Выполните скрипт, чтобы добавить тестовые данные в таблицы базы данных. Для этого:
    - Вставьте код из `Data_insert.sql` в окно MySQL Workbench.
    - Нажмите **Execute**.

### 4. Применение SQL запросов

В папке находятся несколько скриптов с SQL запросами:

- **script_1.sql** — Получить список всех клиентов с их заказами
- **script_2.sql** — Сумма всех заказов по каждому клиенту
- **script_3.sql** — Список клиентов с их бонусами и возвратами

Чтобы выполнить эти запросы, откройте каждый из скриптов в MySQL Workbench и выполните их.

### 5. Создание и использование триггеров

Два триггера были созданы для автоматических операций при изменении данных:

- **trigger_1.sql** — Триггер для предотвращения удаления юридического лица, если оно связано с банковскими реквизитами
Предположим, у нас есть бизнес-правило, согласно которому нельзя удалять юридическое лицо, если оно связано с банковскими реквизитами (т.е. если для этого юридического лица уже существуют записи в таблице Bank_rekviz). Для этого мы создадим триггер, который будет проверять наличие записей в таблице Bank_rekviz перед удалением юридического лица.

```SQL
--попробуем удалить

DELETE FROM `mydb`.`Legal_entity` WHERE `idLegal_entity` = 1;
```

- **trigger_2.sql** — Триггер для поддержания целостности данных при удалении клиента
Допустим, у нас есть правило, что при удалении клиента все его заказы должны быть удалены, чтобы не нарушить целостность данных. Мы можем создать триггер, который будет удалять все заказы, связанные с клиентом, при его удалении.


```SQL
--удалим клиента

DELETE FROM `mydb`.`Client` WHERE `ID_Client` = 1;


--проверка

SELECT * FROM `mydb`.`Order` WHERE `Client_ID_Client` = 1;
```

Чтобы применить триггеры:

1. Откройте каждый файл триггера в MySQL Workbench.
2. Выполните его с помощью кнопки **Execute**.

## 6. Описание структуры базы данных

база данных содержит несколько таблиц, связанных между собой. Вот краткое описание основных таблиц:

- **Legal_entity** — Содержит информацию о юридических лицах.
- **Bank_rekviz** — Данные о банковских реквизитах юридических лиц.
- **Client** — Информация о клиентах.
- **Position** — Должности сотрудников.
- **Employee** — Данные о сотрудниках компании.
- **Cashbox** — Операции в кассе.
- **Check** — Информация о чеке.
- **Bonus_Points** — Бонусные баллы клиентов.
- **Order** — Заказы клиентов.
- **Waybill** — Накладные.
- **Nomenclature** — Перечень товаров и их характеристики.
- **Goods List** — Список товаров в заказах и накладных.
- **Price** — Цены товаров на определенную дату.
- **Warehouse** — Операции с товарами на складе.
- **Strorefront** — Операции с товарами в магазине.
